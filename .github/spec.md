# NovelBox 项目开发规范

## 📋 项目概述

NovelBox 是一款专为小说创作者设计的AI辅助创作工具，支持桌面端和Web端部署，集成12种主流AI模型，提供富文本编辑、AI辅助创作、多数据库支持等功能。

## 🎯 开发目标

### 核心功能
- 书库管理系统（创建、编辑、管理多部小说）
- 章节树结构管理（拖拽排序、实时统计）
- 富文本编辑器（基于QuillJS的增强编辑器）
- AI辅助创作（12种AI模型支持）
- 多数据库后端（MongoDB、MySQL、SQL Server、SQLite）
- 跨平台桌面应用（Windows、Linux、macOS）
- Web应用支持（Docker容器化部署）

### 技术目标
- 类型安全的TypeScript开发
- 响应式用户界面设计
- 高性能AI服务集成
- 可靠的数据持久化
- 优雅的跨平台兼容性

## 🏗️ 技术架构

### 前端架构
```
技术栈：Vue 3 + TypeScript + Element Plus + Tailwind CSS
构建工具：Vite
状态管理：Vue Composition API
路由：Vue Router 4
```

### 桌面端架构
```
框架：Electron 32.3.3
进程间通信：IPC（主进程与渲染进程）
文件系统：Node.js fs模块
窗口管理：多窗口架构（主窗口、片段窗口、设置窗口）
```

### Web端架构
```
部署：Nginx + Docker
存储：浏览器localStorage + 云端数据库
文件操作：浏览器下载/上传API
```

### 后端服务
```
AI服务：12种AI模型（OpenAI、Anthropic、Google、DeepSeek、MiniMax、Ollama、LM Studio、Kimi、文心一言、阿里百炼、硅基流动、魔塔社区）
数据库：MongoDB、MySQL、SQL Server、SQLite、本地文件系统
文档处理：docx.js
```

## 📊 功能规格

### 书库管理
- **书籍创建**：支持创建新书籍，设置书名、作者、简介
- **书籍编辑**：编辑书籍基本信息，支持封面图片
- **书籍列表**：展示所有书籍，支持搜索和筛选
- **书籍删除**：安全删除书籍，包含确认机制
- **书籍导出**：导出为DOCX格式，保留格式和样式

### 章节管理
- **章节树结构**：层级化展示章节，支持嵌套
- **章节操作**：创建、编辑、删除、重命名章节
- **拖拽排序**：直观的拖拽调整章节顺序
- **字数统计**：实时显示章节字数和总字数
- **章节导航**：快速跳转和面包屑导航

### 富文本编辑
- **基础格式**：粗体、斜体、下划线、删除线
- **标题样式**：H1-H6标题支持
- **列表功能**：有序列表、无序列表、任务列表
- **插入元素**：图片、表格、链接、分隔线
- **文本对齐**：左对齐、居中、右对齐、两端对齐
- **查找替换**：全文搜索和批量替换

### AI辅助创作
- **智能续写**：根据上下文自动生成后续内容
- **内容扩写**：扩展选中文本的篇幅和细节
- **内容缩写**：压缩文本长度，保留核心信息
- **定向改写**：按指定要求改写选中文本
- **书名生成**：基于内容智能生成书名建议
- **简介生成**：自动生成作品简介
- **智能校对**：检测错别字和语法错误

### 数据库管理
- **多数据库支持**：MongoDB、MySQL、SQL Server、SQLite
- **数据库切换**：运行时切换不同数据库后端
- **数据迁移**：支持数据库间的数据迁移
- **备份恢复**：数据备份和恢复功能
- **性能优化**：查询优化和索引管理

## 🔧 技术规格

### 性能要求
- **启动时间**：桌面应用<3秒，Web应用<2秒
- **响应时间**：用户操作响应<100ms
- **AI请求**：单次AI请求<30秒（流式响应）
- **内存占用**：桌面应用<500MB，Web应用<200MB
- **存储效率**：数据压缩存储，减少空间占用

### 兼容性要求
- **桌面端**：Windows 10+、macOS 10.15+、Linux Ubuntu 18.04+
- **Web端**：Chrome 80+、Firefox 75+、Safari 13+、Edge 80+
- **移动端**：响应式设计，支持平板和手机访问
- **国际化**：支持多语言界面（中文、英文优先）

### 安全要求
- **数据安全**：本地数据加密存储
- **API安全**：AI服务API密钥安全存储
- **网络安全**：HTTPS通信，防止XSS和CSRF攻击
- **权限控制**：文件系统访问权限管理

### 可靠性要求
- **数据完整性**：事务处理，防止数据损坏
- **错误处理**：完善的错误捕获和处理机制
- **自动保存**：定时自动保存，防止数据丢失
- **崩溃恢复**：应用崩溃后能够恢复未保存数据

## 📁 项目结构规范

### 目录结构
```
src/
├── components/          # Vue组件
│   ├── *.vue           # 组件文件
│   └── __tests__/      # 组件测试
├── views/              # 页面视图
│   ├── *.vue           # 页面组件
│   └── __tests__/      # 页面测试
├── services/           # 业务服务层
│   ├── *Service.ts     # 服务类
│   ├── __tests__/      # 服务测试
│   └── interfaces/     # 接口定义
├── controllers/        # 控制器层
│   ├── *Controller.ts  # 控制器
│   └── __tests__/      # 控制器测试
├── utils/              # 工具函数
│   ├── *.ts            # 工具函数
│   └── __tests__/      # 工具测试
├── types/              # 类型定义
│   └── *.d.ts          # TypeScript类型
└── assets/             # 静态资源
```

### 文件命名规范
- **组件文件**：PascalCase命名（如：`ChapterTree.vue`）
- **工具函数**：camelCase命名（如：`formatDate.ts`）
- **类型定义**：PascalCase命名（如：`BookConfig.ts`）
- **测试文件**：`.test.ts`或`.spec.ts`后缀
- **样式文件**：与组件同名，`.css`或`.scss`后缀

## 🎨 编码规范

### TypeScript规范
- **严格模式**：启用TypeScript严格模式
- **类型定义**：所有函数参数和返回值必须声明类型
- **接口优先**：优先使用接口定义对象形状
- **枚举使用**：使用枚举定义常量集合
- **泛型应用**：合理使用泛型提高代码复用性

### Vue组件规范
- **组合式API**：优先使用Composition API
- **组件结构**：统一的组件结构（模板、脚本、样式）
- **Props定义**：详细的props类型和默认值定义
- **Emits声明**：明确的emits事件声明
- **生命周期**：合理使用生命周期钩子

### 代码风格
- **缩进**：2个空格缩进
- **引号**：单引号优先
- **分号**：必须使用分号
- **逗号**：多行对象和数组使用尾随逗号
- **最大长度**：单行代码不超过100字符

### 注释规范
- **函数注释**：所有公共函数必须有JSDoc注释
- **复杂逻辑**：复杂算法和逻辑需要详细注释
- **TODO标记**：使用TODO、FIXME、HACK标记待处理事项
- **文档注释**：重要类和模块需要详细文档说明

## 🧪 测试规范

### 测试策略
- **单元测试**：所有服务类和工具函数必须有单元测试
- **组件测试**：所有Vue组件必须有组件测试
- **集成测试**：关键业务流程需要集成测试
- **端到端测试**：核心用户流程需要E2E测试

### 测试覆盖率
- **总体覆盖率**：不低于80%
- **核心模块**：不低于90%
- **新增代码**：必须100%覆盖
- **边界条件**：重点测试异常和边界情况

### 测试工具
- **测试框架**：Vitest（单元测试）
- **组件测试**：Vue Test Utils
- **E2E测试**：Cypress或Playwright
- **覆盖率**：c8或istanbul

## 📋 开发流程

### Git工作流
- **主分支**：`main`分支，稳定发布版本
- **开发分支**：`dev`分支，日常开发
- **功能分支**：`feature/*`，新功能开发
- **修复分支**：`fix/*`，bug修复
- **发布分支**：`release/*`，版本发布准备

### 提交规范
```
<type>(<scope>): <subject>

<body>

<footer>
```

**类型说明**：
- `feat`：新功能
- `fix`：bug修复
- `docs`：文档更新
- `style`：代码格式调整
- `refactor`：代码重构
- `test`：测试相关
- `chore`：构建工具或辅助工具

### Pull Request流程
1. **创建分支**：从dev分支创建功能分支
2. **开发实现**：按照规范进行开发
3. **本地测试**：运行所有测试用例
4. **提交PR**：填写PR模板，描述变更内容
5. **代码审查**：至少一名审查者批准
6. **合并代码**：通过CI检查后合并到dev分支

## 🚀 部署规范

### 构建规范
- **环境分离**：开发、测试、生产环境分离
- **构建版本**：每个构建都有唯一版本号
- **构建日志**：详细记录构建过程和结果
- **制品管理**：构建产物统一管理和归档

### 发布流程
1. **版本规划**：确定发布内容和版本号
2. **代码冻结**：停止新功能开发，专注bug修复
3. **发布测试**：全面测试即将发布的版本
4. **构建打包**：构建所有平台的发布包
5. **发布验证**：验证发布包的功能和性能
6. **正式发布**：发布到各个平台和渠道

## 📊 监控规范

### 性能监控
- **启动时间**：监控应用启动性能
- **内存使用**：监控内存占用和泄漏
- **响应时间**：监控用户操作响应时间
- **错误率**：监控运行时错误率

### 用户监控
- **功能使用**：统计功能使用频率
- **用户行为**：分析用户操作路径
- **崩溃报告**：收集和分析崩溃信息
- **性能反馈**：收集用户性能体验反馈

## 🔧 维护规范

### 代码维护
- **定期重构**：每季度进行代码重构和优化
- **依赖更新**：及时更新第三方依赖
- **技术债务**：定期偿还技术债务
- **代码审查**：定期进行代码质量审查

### 文档维护
- **文档同步**：代码变更时同步更新文档
- **API文档**：保持API文档的准确性
- **用户手册**：定期更新用户操作手册
- **开发指南**：持续完善开发指南

## 📝 变更记录

### 版本控制
- **语义化版本**：遵循SemVer版本规范
- **变更日志**：详细记录每个版本的变更
- **兼容性**：保持向后兼容性
- **迁移指南**：提供版本迁移指导

### 配置管理
- **配置分离**：代码与配置分离
- **环境配置**：不同环境的配置管理
- **敏感信息**：安全存储敏感配置信息
- **配置验证**：配置变更时进行验证

---

**最后更新**：2025年9月
**维护者**：NovelBox开发团队
**审核状态**：待团队审核